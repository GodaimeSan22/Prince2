<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Simulator | PRINCE2 Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); }
        .option-card { transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.05); }
        .option-card:hover { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.5); }
        .correct { background: rgba(34, 197, 94, 0.15) !important; border-color: #22c55e !important; color: #4ade80; }
        .wrong { background: rgba(239, 68, 68, 0.15) !important; border-color: #ef4444 !important; color: #f87171; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-[#030712] text-white font-['Inter']">

    <nav class="p-6 border-b border-white/5 glass sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-sm font-bold tracking-tighter uppercase italic tracking-widest">
                PRINCE2 <span class="text-blue-500 font-black">MASTER</span>
            </a>
            <div id="progress-text" class="text-[10px] font-mono text-slate-500 uppercase tracking-[0.2em]">
                Initializing Exam...
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-6 py-12">
        <div id="progress-bar-container" class="w-full bg-white/5 h-1 rounded-full mb-12 overflow-hidden">
            <div id="progress-bar" class="bg-blue-600 h-full transition-all duration-700 shadow-[0_0_15px_rgba(37,99,235,0.5)]" style="width: 0%"></div>
        </div>

        <div id="quiz-container">
            <div id="question-box" class="mb-10">
                <span id="q-category" class="text-blue-500 text-[10px] font-black tracking-[0.4em] uppercase mb-4 block leading-none">Category</span>
                <h2 id="q-text" class="text-2xl md:text-3xl font-bold leading-tight tracking-tight text-slate-100 italic uppercase"></h2>
            </div>

            <div id="options-container" class="space-y-4">
                </div>

            <div id="feedback-container" class="mt-10 hidden">
                <div id="rationale-box" class="p-8 rounded-[2rem] bg-white/5 border border-white/10 text-sm text-slate-400 mb-8 leading-relaxed shadow-inner">
                    </div>
                <button onclick="nextQuestion()" class="w-full py-5 bg-blue-600 hover:bg-blue-500 rounded-2xl font-black text-xs uppercase tracking-[0.3em] transition-all shadow-xl shadow-blue-600/20 active:scale-[0.98]">
                    Continue to Next Question
                </button>
            </div>
        </div>

        <div id="results-screen" class="hidden text-center py-16">
            <div class="inline-flex items-center justify-center p-6 rounded-full bg-blue-500/10 mb-8 border border-blue-500/20">
                <svg class="w-16 h-16 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h2 class="text-6xl font-black mb-4 italic uppercase tracking-tighter">Sprint <span class="text-blue-500">Complete</span></h2>
            <p id="score-text" class="text-2xl text-slate-400 mb-12 font-light leading-relaxed"></p>
            
            <div class="flex flex-col sm:flex-row gap-5 justify-center">
                <button onclick="location.reload()" class="px-12 py-5 bg-white text-black rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] hover:bg-slate-200 transition-all shadow-lg shadow-white/5">
                    New Sprint
                </button>
                <a href="index.html" class="px-12 py-5 border border-white/10 rounded-2xl font-black uppercase text-[10px] tracking-[0.2em] hover:bg-white/5 transition-all text-slate-300">
                    Exit to Encyclopedia
                </a>
            </div>
        </div>
    </main>

    <script src="questions.js"></script>

    <script>
        let currentIdx = 0;
        let score = 0;
        let answered = false;
        let sessionQuestions = [];
        let timeLeft = 15 * 60; // 15 Minutes
        let timerInterval;

        function initQuiz() {
            // Check if questions array exists from questions.js
            if (typeof questions === 'undefined' || questions.length === 0) {
                const qTextElement = document.getElementById('q-text');
                if (qTextElement) {
                    qTextElement.innerHTML = "<span class='text-red-500 uppercase'>Data Error:</span> questions.js not found or empty.";
                }
                return;
            }

            // Shuffle and pick 15 questions for the sprint
            sessionQuestions = [...questions]
                .sort(() => Math.random() - 0.5)
                .slice(0, 15);

            startTimer();
            loadQuestion();
        }

        function startTimer() {
            const timerDisplay = document.getElementById('progress-text');
            timerInterval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                timerDisplay.innerText = `Q: ${currentIdx + 1}/15 | TIME: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showResults();
                }
                timeLeft--;
            }, 1000);
        }

        function loadQuestion() {
            answered = false;
            const q = sessionQuestions[currentIdx];
            
            // Progress Bar
            document.getElementById('progress-bar').style.width = `${((currentIdx + 1) / 15) * 100}%`;
            
            // Content
            document.getElementById('q-category').innerText = q.category;
            document.getElementById('q-text').innerText = q.question;
            document.getElementById('feedback-container').classList.add('hidden');
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'option-card p-6 rounded-2xl cursor-pointer text-sm md:text-base font-medium flex gap-5 items-center bg-white/[0.02]';
                div.innerHTML = `
                    <span class="w-8 h-8 rounded-xl bg-white/5 border border-white/5 flex items-center justify-center text-[10px] font-bold text-slate-500 flex-shrink-0 transition-colors">
                        ${String.fromCharCode(64 + 1 + i)}
                    </span> 
                    <span class="text-slate-300">${opt}</span>
                `;
                div.onclick = () => checkAnswer(i, div);
                container.appendChild(div);
            });
        }

        function checkAnswer(idx, element) {
            if(answered) return;
            answered = true;
            
            const q = sessionQuestions[currentIdx];
            const cards = document.querySelectorAll('.option-card');
            
            if(idx === q.correct) {
                element.classList.add('correct');
                element.querySelector('span:first-child').classList.add('bg-green-500/20', 'text-green-500', 'border-green-500/40');
                score++;
            } else {
                element.classList.add('wrong');
                element.querySelector('span:first-child').classList.add('bg-red-500/20', 'text-red-500', 'border-red-500/40');
                
                // Show correct one
                cards[q.correct].classList.add('correct');
                cards[q.correct].querySelector('span:first-child').classList.add('bg-green-500/20', 'text-green-500', 'border-green-500/40');
            }
            
            document.getElementById('rationale-box').innerHTML = `
                <div class="flex items-center gap-2 mb-3">
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                    <strong class="text-blue-500 font-bold uppercase tracking-[0.2em] text-[10px]">Official Rationale</strong>
                </div>
                <div class="text-slate-200">${q.rationale}</div>
            `;
            document.getElementById('feedback-container').classList.remove('hidden');
            
            setTimeout(() => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 150);
        }

        function nextQuestion() {
            currentIdx++;
            if(currentIdx < sessionQuestions.length) {
                loadQuestion();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                clearInterval(timerInterval);
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('progress-bar-container').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            document.getElementById('progress-text').innerText = "Sprint Finished";
            
            const percent = Math.round((score / 15) * 100);
            const passed = percent >= 60;
            
            document.getElementById('score-text').innerHTML = `
                <span class="block text-7xl font-black text-white mb-4 tracking-tighter">${percent}%</span>
                Correct: <span class="text-white font-bold">${score}</span> out of 15<br>
                <div class="mt-8">
                    <span class="px-6 py-2 rounded-full border ${passed ? 'border-green-500 text-green-500 bg-green-500/5' : 'border-red-500 text-red-500 bg-red-500/5'} font-bold uppercase text-[10px] tracking-widest">
                        Status: ${passed ? 'Certified / Pass' : 'Review Required / Fail'}
                    </span>
                </div>
            `;
        }

        // Initialize when window loads
        window.onload = initQuiz;
    </script>
</body>
</html>